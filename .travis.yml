language:
  - objective-c

env:
  global:
    - MB_PYTHON_VERSION=3.7
    - WHEEL_SPEC="wheel"
    - WHEELHOUSE_UPLOADER_USERNAME=travis-worker
    # Following generated with
    # travis encrypt -r matthew-brett/delocate WHEELHOUSE_UPLOADER_SECRET=<the api key>
    - secure: "BRc15pHO6+WwBh36X7KK4KFC+/hD7G3r5bmkKkWqUSrm1fhFkqDizj9V5g/9pGEcAl5FRLV0VZjTeceISfu2UhXxQxj4CkkTy7KYuSbZak2pEntfsDs7YBpQ3NHJ6ic8YdcWgptRXIQfmg/KPc9FsBIfLxJ2yVyyY7D9XpK+SvQ="

# Default macOS (xcode image) is 10.13 (xcode 9.4.1) as of 2021-07-09
# See: https://docs.travis-ci.com/user/reference/osx

matrix:
  include:
#     - env: MB_PYTHON_VERSION=2.7
#     - env: MB_PYTHON_VERSION=3.5
#     - env: MB_PYTHON_VERSION=3.6
#     - env: MB_PYTHON_VERSION=3.8
#     - env: MB_PYTHON_VERSION=3.9
#     # Xcode 12.0 macOS 10.15.5
#     - osx_image: xcode12
#     # Xcode 9.0 macOS 10.12
#     - osx_image: xcode9
#     # Xcode 12.3 macOS 11.1
      - osx_image: xcode12.3
        env:
          - MB_PYTHON_VERSION=3.9
          - MB_PYTHON_OSX_VER=10.9
          - BUILD_WHEELS=1

install:
  - source multibuild/osx_utils.sh
  - get_macpython_environment $MB_PYTHON_VERSION venv
  - pip install $WHEEL_SPEC pytest
  - if [ -n "$BUILD_WHEELS" ]; then
        pip install cython;
        (cd wheel_makers && ./make_wheels.sh);
    fi
  - pip install .

script:
  - echo $PWD
  - mkdir tmp_test_dir
  - cd tmp_test_dir
  - pytest --pyargs delocate --log-level DEBUG
